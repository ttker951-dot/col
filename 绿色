local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

if not RunService:IsClient() then
    warn("此脚本仅在客户端运行")
end

-- 纯绿色调色板
local GreenPalette = {
    Bright = Color3.fromRGB(0, 255, 100),       -- 亮绿
    Forest = Color3.fromRGB(0, 180, 80),        -- 森林绿
    Dark = Color3.fromRGB(0, 120, 50),          -- 深绿
    Lime = Color3.fromRGB(150, 255, 100),       -- 柠檬绿
    ParticleDefault = ColorSequence.new(Color3.fromRGB(0, 255, 100))
}

local function dyeEffectGreen(effect)
    pcall(function()
        if effect:IsA("ParticleEmitter") then
            effect.Color = GreenPalette.ParticleDefault
            -- 随机使用不同绿色渐变
            if math.random(1, 3) == 1 then
                effect.Color = ColorSequence.new({
                    ColorSequenceKeypoint.new(0, GreenPalette.Dark),
                    ColorSequenceKeypoint.new(1, GreenPalette.Bright)
                })
            end
        elseif effect:IsA("Beam") then
            effect.Color = ColorSequence.new(GreenPalette.Bright)
        elseif effect:IsA("Trail") then
            effect.Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, GreenPalette.Dark),
                ColorSequenceKeypoint.new(1, GreenPalette.Lime)
            })
        elseif effect:IsA("Smoke") then
            effect.Color = Color3.fromRGB(150, 220, 180) -- 淡绿色烟雾
            effect.Opacity = 0.75
        elseif effect:IsA("Fire") then
            effect.Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, GreenPalette.Dark),
                ColorSequenceKeypoint.new(0.5, GreenPalette.Forest),
                ColorSequenceKeypoint.new(1, GreenPalette.Bright)
            })
            effect.Size = effect.Size * 1.25
        elseif effect:IsA("Sparkles") then
            effect.SparkleColor = GreenPalette.Bright
        elseif effect:IsA("Explosion") then
            effect.BlastPressure = 1
            effect.BlastRadius = 20
        elseif effect:IsA("Light") then
            effect.Color = GreenPalette.Lime
        end
        effect:SetAttribute("DyedGreen", true)
    end)
end

local function dyeAllEffectsGreen()
    print("正在将所有特效染为绿色...")
    local effectTypes = {"ParticleEmitter", "Beam", "Trail", "Smoke", "Fire", "Sparkles", "Explosion", "Light"}
    local totalEffects = 0
    local dyedEffects = 0
    
    for _, descendant in ipairs(game:GetDescendants()) do
        for _, effectType in ipairs(effectTypes) do
            if descendant:IsA(effectType) then
                totalEffects = totalEffects + 1
                if not descendant:GetAttribute("DyedGreen") then
                    dyeEffectGreen(descendant)
                    dyedEffects = dyedEffects + 1
                end
            end
        end
    end
    
    print(string.format("已找到 %d 个特效，成功染色 %d 个", totalEffects, dyedEffects))
    
    _G.GreenEffects = {
        Reapply = dyeAllEffectsGreen,
        Palette = GreenPalette,
        DyeFunction = dyeEffectGreen,
        CustomGreen = function(r, g, b)
            GreenPalette.Bright = Color3.fromRGB(r, g, b)
            GreenPalette.ParticleDefault = ColorSequence.new(Color3.fromRGB(r, g, b))
            dyeAllEffectsGreen()
        end
    }
    return dyedEffects
end

-- 立即应用绿色效果
dyeAllEffectsGreen()



-- 监听新加入的特效
game.DescendantAdded:Connect(function(newDescendant)
    task.wait(0.05)
    local effectTypes = {"ParticleEmitter", "Beam", "Trail", "Smoke", "Fire", "Sparkles", "Explosion", "Light"}
    for _, effectType in ipairs(effectTypes) do
        if newDescendant:IsA(effectType) then
            task.wait(0.1)
            if not newDescendant:GetAttribute("DyedGreen") then
                dyeEffectGreen(newDescendant)
                print("已染色新特效: " .. newDescendant:GetFullName())
            end
        end
    end
end)
