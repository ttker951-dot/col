local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

if not RunService:IsClient() then
    warn("此脚本仅在客户端运行")
end

-- 纯蓝色调色板
local BluePalette = {
    Bright = Color3.fromRGB(0, 100, 255),       -- 亮蓝
    Sky = Color3.fromRGB(100, 150, 255),        -- 天蓝
    Deep = Color3.fromRGB(0, 50, 200),          -- 深蓝
    Ice = Color3.fromRGB(200, 230, 255),        -- 冰蓝
    ParticleDefault = ColorSequence.new(Color3.fromRGB(0, 100, 255))
}

local function dyeEffectBlue(effect)
    pcall(function()
        if effect:IsA("ParticleEmitter") then
            effect.Color = BluePalette.ParticleDefault
            -- 1/3的概率使用蓝色渐变
            if math.random(1, 3) == 1 then
                effect.Color = ColorSequence.new({
                    ColorSequenceKeypoint.new(0, BluePalette.Deep),
                    ColorSequenceKeypoint.new(0.5, BluePalette.Sky),
                    ColorSequenceKeypoint.new(1, BluePalette.Bright)
                })
            end
        elseif effect:IsA("Beam") then
            effect.Color = ColorSequence.new(BluePalette.Bright)
        elseif effect:IsA("Trail") then
            effect.Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, BluePalette.Deep),
                ColorSequenceKeypoint.new(1, BluePalette.Bright)
            })
        elseif effect:IsA("Smoke") then
            effect.Color = Color3.fromRGB(180, 200, 255) -- 淡蓝色烟雾
            effect.Opacity = 0.7
        elseif effect:IsA("Fire") then
            effect.Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, BluePalette.Deep),
                ColorSequenceKeypoint.new(0.3, BluePalette.Sky),
                ColorSequenceKeypoint.new(0.7, BluePalette.Bright),
                ColorSequenceKeypoint.new(1, BluePalette.Ice)
            })
            effect.Size = effect.Size * 1.2
        elseif effect:IsA("Sparkles") then
            effect.SparkleColor = BluePalette.Bright
        elseif effect:IsA("Explosion") then
            effect.BlastPressure = 1
            effect.BlastRadius = 20
        elseif effect:IsA("Light") then
            effect.Color = BluePalette.Sky
            effect.Brightness = effect.Brightness * 1.5
        end
        effect:SetAttribute("DyedBlue", true)
    end)
end

local function dyeAllEffectsBlue()
    print("正在将所有特效染为蓝色...")
    local effectTypes = {"ParticleEmitter", "Beam", "Trail", "Smoke", "Fire", "Sparkles", "Explosion", "Light"}
    local totalEffects = 0
    local dyedEffects = 0
    
    for _, descendant in ipairs(game:GetDescendants()) do
        for _, effectType in ipairs(effectTypes) do
            if descendant:IsA(effectType) then
                totalEffects = totalEffects + 1
                if not descendant:GetAttribute("DyedBlue") then
                    dyeEffectBlue(descendant)
                    dyedEffects = dyedEffects + 1
                end
            end
        end
    end
    
    print(string.format("已找到 %d 个特效，成功染色 %d 个", totalEffects, dyedEffects))
    _G.BlueEffects = {
        Reapply = dyeAllEffectsBlue,
        Palette = BluePalette,
        DyeFunction = dyeEffectBlue,
        CustomBlue = function(r, g, b)
            BluePalette.Bright = Color3.fromRGB(r, g, b)
            BluePalette.ParticleDefault = ColorSequence.new(Color3.fromRGB(r, g, b))
            dyeAllEffectsBlue()
        end
    }
    return dyedEffects
end

dyeAllEffectsBlue()

print("蓝色特效系统已激活")
print("使用 _G.BlueEffects.Reapply() 重新应用蓝色")
print("使用 _G.BlueEffects.DyeFunction(特效实例) 单独染色")
print("使用 _G.BlueEffects.CustomBlue(红, 绿, 蓝) 自定义蓝色")

-- 监听新加入的特效
game.DescendantAdded:Connect(function(newDescendant)
    task.wait(0.05)
    local effectTypes = {"ParticleEmitter", "Beam", "Trail", "Smoke", "Fire", "Sparkles", "Explosion", "Light"}
    for _, effectType in ipairs(effectTypes) do
        if newDescendant:IsA(effectType) then
            task.wait(0.1)
            if not newDescendant:GetAttribute("DyedBlue") then
                dyeEffectBlue(newDescendant)
                print("已染色新特效: " .. newDescendant:GetFullName())
            end
        end
    end
end)

-- 可选：添加一个蓝色主题的屏幕效果
local function addBlueAmbience()
    if game:GetService("Lighting"):FindFirstChild("BlueTint") then
        game:GetService("Lighting").BlueTint:Destroy()
    end
    
    local colorCorrection = Instance.new("ColorCorrectionEffect")
    colorCorrection.Name = "BlueTint"
    colorCorrection.Brightness = 0.05
    colorCorrection.Contrast = 0.1
    colorCorrection.Saturation = -0.1
    colorCorrection.TintColor = Color3.fromRGB(200, 220, 255)
    colorCorrection.Enabled = true
    colorCorrection.Parent = game:GetService("Lighting")
    
    print("已添加蓝色氛围效果")
end

-- 可选：按需调用
-- addBlueAmbience()
