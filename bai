local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

if not RunService:IsClient() then
    warn("")
end

local WhitePalette = {
    Bright = Color3.fromRGB(255, 255, 255),
    Soft = Color3.fromRGB(240, 240, 240),
    Warm = Color3.fromRGB(255, 250, 240),
    ParticleDefault = ColorSequence.new(Color3.fromRGB(255, 255, 255))
}

local function dyeEffectWhite(effect)
    pcall(function()
        if effect:IsA("ParticleEmitter") then
            effect.Color = WhitePalette.ParticleDefault
            if math.random(1, 3) == 1 then
                effect.Color = ColorSequence.new({
                    ColorSequenceKeypoint.new(0, WhitePalette.Warm),
                    ColorSequenceKeypoint.new(1, WhitePalette.Bright)
                })
            end
        elseif effect:IsA("Beam") then
            effect.Color = ColorSequence.new(WhitePalette.Bright)
        elseif effect:IsA("Trail") then
            effect.Color = ColorSequence.new(WhitePalette.Bright)
        elseif effect:IsA("Smoke") then
            effect.Color = WhitePalette.Soft
            effect.Opacity = 0.8
        elseif effect:IsA("Fire") then
            effect.Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, WhitePalette.Warm),
                ColorSequenceKeypoint.new(0.5, WhitePalette.Soft),
                ColorSequenceKeypoint.new(1, WhitePalette.Bright)
            })
            effect.Size = effect.Size * 1.3
        elseif effect:IsA("Sparkles") then
            effect.SparkleColor = WhitePalette.Bright
        end
        effect:SetAttribute("DyedWhite", true)
    end)
end

local function dyeAllEffectsWhite()
    print("")
    local effectTypes = {"ParticleEmitter", "Beam", "Trail", "Smoke", "Fire", "Sparkles", "Explosion"}
    local totalEffects = 0
    local dyedEffects = 0
    
    for _, descendant in ipairs(game:GetDescendants()) do
        for _, effectType in ipairs(effectTypes) do
            if descendant:IsA(effectType) then
                totalEffects = totalEffects + 1
                if not descendant:GetAttribute("DyedWhite") then
                    dyeEffectWhite(descendant)
                    dyedEffects = dyedEffects + 1
                end
            end
        end
    end
    
    print(string.format("", totalEffects, dyedEffects))
    _G.WhiteEffects = {
        Reapply = dyeAllEffectsWhite,
        Palette = WhitePalette,
        DyeFunction = dyeEffectWhite
    }
    return dyedEffects
end

dyeAllEffectsWhite()

print("")
print("")
print("")

game.DescendantAdded:Connect(function(newDescendant)
    task.wait(0.05)
    local effectTypes = {"ParticleEmitter", "Beam", "Trail", "Smoke", "Fire", "Sparkles", "Explosion"}
    for _, effectType in ipairs(effectTypes) do
        if newDescendant:IsA(effectType) then
            task.wait(0.1)
            if not newDescendant:GetAttribute("DyedWhite") then
                dyeEffectWhite(newDescendant)
                print("", newDescendant:GetFullName())
            end
        end
    end
end)
