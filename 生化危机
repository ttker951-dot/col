local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

if not RunService:IsClient() then
    warn("ç”ŸåŒ–æ¯’æ¶²ç‰¹æ•ˆä»…å®¢æˆ·ç«¯ç”Ÿæ•ˆ")
end

-- â˜£ï¸ ç”ŸåŒ–æ¯’æ¶²é…è‰²æ–¹æ¡ˆ
local BiohazardPalette = {
    -- æ ¸å¿ƒæ¯’æ¶²è‰²
    ToxicGreen = Color3.fromRGB(124, 252, 0),         -- è§å…‰æ¯’ç»¿ #7CFC00
    SlimeYellow = Color3.fromRGB(173, 255, 47),       -- ç²˜æ¶²é»„ #ADFF2F
    CorrosivePurple = Color3.fromRGB(138, 43, 226),   -- è…èš€ç´« #8A2BE2
    RadioactiveGreen = Color3.fromRGB(57, 255, 20),   -- æ”¾å°„æ€§ç»¿ #39FF14
    
    -- ç—…æ¯’/è¡€æ¶²è‰²
    VirusRed = Color3.fromRGB(255, 0, 0),             -- ç—…æ¯’çº¢ #FF0000
    InfectionPurple = Color3.fromRGB(128, 0, 128),    -- æ„ŸæŸ“ç´« #800080
    BioGreen = Color3.fromRGB(50, 205, 50),           -- ç”ŸåŒ–ç»¿ #32CD32
    PoisonBlood = Color3.fromRGB(102, 0, 102),        -- æ¯’è¡€ç´« #660066
    
    -- é»æ¶²/æœ‰æœºè‰²
    MucusCyan = Color3.fromRGB(0, 255, 255),          -- é»æ¶²é’ #00FFFF
    OrganicYellow = Color3.fromRGB(255, 255, 0),      -- æœ‰æœºé»„ #FFFF00
    DecayBrown = Color3.fromRGB(101, 67, 33),         -- è…åŒ–æ£• #654321
    FleshPink = Color3.fromRGB(255, 192, 203),        -- è‚‰è‰²ç²‰ #FFC0CB
    
    -- æ¸å˜é¢„è®¾
    ToxicSlime = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(124, 252, 0)),     -- æ¯’ç»¿
        ColorSequenceKeypoint.new(0.3, Color3.fromRGB(173, 255, 47)),  -- ç²˜æ¶²é»„
        ColorSequenceKeypoint.new(0.6, Color3.fromRGB(50, 205, 50)),   -- ç”ŸåŒ–ç»¿
        ColorSequenceKeypoint.new(1, Color3.fromRGB(124, 252, 0))      -- æ¯’ç»¿
    }),
    
    VirusSpread = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),       -- ç—…æ¯’çº¢
        ColorSequenceKeypoint.new(0.2, Color3.fromRGB(128, 0, 128)),   -- æ„ŸæŸ“ç´«
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(57, 255, 20)),   -- æ”¾å°„ç»¿
        ColorSequenceKeypoint.new(0.8, Color3.fromRGB(128, 0, 128)),   -- æ„ŸæŸ“ç´«
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0))        -- ç—…æ¯’çº¢
    }),
    
    CorrosionFlow = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(138, 43, 226)),    -- è…èš€ç´«
        ColorSequenceKeypoint.new(0.4, Color3.fromRGB(102, 0, 102)),   -- æ¯’è¡€ç´«
        ColorSequenceKeypoint.new(0.7, Color3.fromRGB(50, 205, 50)),   -- ç”ŸåŒ–ç»¿
        ColorSequenceKeypoint.new(1, Color3.fromRGB(138, 43, 226))     -- è…èš€ç´«
    }),
    
    MucusBubble = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 255, 255)),     -- é»æ¶²é’
        ColorSequenceKeypoint.new(0.3, Color3.fromRGB(124, 252, 0)),   -- æ¯’ç»¿
        ColorSequenceKeypoint.new(0.6, Color3.fromRGB(173, 255, 47)),  -- ç²˜æ¶²é»„
        ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 255, 255))      -- é»æ¶²é’
    }),
    
    BioGlow = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(20, 100, 20)),     -- æš—ç»¿
        ColorSequenceKeypoint.new(0.2, Color3.fromRGB(50, 205, 50)),   -- ç”ŸåŒ–ç»¿
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(124, 252, 0)),   -- æ¯’ç»¿
        ColorSequenceKeypoint.new(0.8, Color3.fromRGB(50, 205, 50)),   -- ç”ŸåŒ–ç»¿
        ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 100, 20))      -- æš—ç»¿
    }),
    
    InfectionPulse = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(102, 0, 102)),     -- æ¯’è¡€ç´«
        ColorSequenceKeypoint.new(0.3, Color3.fromRGB(255, 0, 0)),     -- ç—…æ¯’çº¢
        ColorSequenceKeypoint.new(0.6, Color3.fromRGB(128, 0, 128)),   -- æ„ŸæŸ“ç´«
        ColorSequenceKeypoint.new(0.9, Color3.fromRGB(255, 0, 0)),     -- ç—…æ¯’çº¢
        ColorSequenceKeypoint.new(1, Color3.fromRGB(102, 0, 102))      -- æ¯’è¡€ç´«
    })
}

-- ğŸ§ª ç”ŸåŒ–æ•ˆæœå‡½æ•°
local function applyBiohazardEffect(effect)
    pcall(function()
        local effectName = effect.Name:lower()
        local isToxic = string.find(effectName, "toxic") or string.find(effectName, "poison") or string.find(effectName, "venom")
        local isSlime = string.find(effectName, "slime") or string.find(effectName, "mucus") or string.find(effectName, "goo")
        local isVirus = string.find(effectName, "virus") or string.find(effectName, "infection") or string.find(effectName, "disease")
        local isAcid = string.find(effectName, "acid") or string.find(effectName, "corros") or string.find(effectName, "melt")
        local isOrganic = string.find(effectName, "bio") or string.find(effectName, "flesh") or string.find(effectName, "organic")
        
        if effect:IsA("ParticleEmitter") then
            -- é€‰æ‹©ç”ŸåŒ–æ–¹æ¡ˆ
            local scheme
            local viscosity = 1  -- ç²˜ç¨ åº¦
            
            if isToxic then
                scheme = BiohazardPalette.ToxicSlime
                viscosity = 1.3
                effect.Rate = (effect.Rate or 20) * 1.2
                effect.Lifetime = NumberRange.new(0.8, 1.5)
                effect.LightEmission = 0.8
                
                -- æ¯’æ€§æ°”ä½“æ•ˆæœ
                effect.Drag = (effect.Drag or 0) + 0.4
                effect.Acceleration = Vector3.new(0, 2, 0)  -- ç¼“æ…¢ä¸Šå‡
                
            elseif isSlime then
                scheme = BiohazardPalette.MucusBubble
                viscosity = 1.8
                effect.Rate = (effect.Rate or 20) * 0.7  -- ç²˜æ¶²æµåŠ¨æ…¢
                effect.Lifetime = NumberRange.new(1.5, 3)
                effect.LightEmission = 0.6
                
                -- ç²˜æ¶²ç‰¹æ€§
                effect.Drag = (effect.Drag or 0) + 0.8
                effect.Acceleration = Vector3.new(0, -10, 0)  -- å‘ä¸‹æµåŠ¨
                effect.Rotation = NumberRange.new(-90, 90)
                
            elseif isVirus then
                scheme = BiohazardPalette.VirusSpread
                viscosity = 1.1
                effect.Rate = (effect.Rate or 20) * 1.5
                effect.Lifetime = NumberRange.new(0.5, 1)
                effect.LightEmission = 0.9
                
                -- ç—…æ¯’æ‰©æ•£æ•ˆæœ
                effect.SpreadAngle = Vector2.new(360, 360)  -- å…¨æ–¹ä½æ‰©æ•£
                effect.VelocitySpread = (effect.VelocitySpread or 10) * 2
                
            elseif isAcid then
                scheme = BiohazardPalette.CorrosionFlow
                viscosity = 1.2
                effect.Rate = (effect.Rate or 20) * 1.4
                effect.Lifetime = NumberRange.new(0.6, 1.2)
                effect.LightEmission = 0.7
                
                -- è…èš€æ€§çƒŸé›¾
                effect.Speed = NumberRange.new(3, 8)
                effect.Acceleration = Vector3.new(0, 5, 0)
                
            elseif isOrganic then
                scheme = BiohazardPalette.BioGlow
                viscosity = 1.4
                effect.Rate = (effect.Rate or 20) * 1.1
                effect.Lifetime = NumberRange.new(1, 2)
                effect.LightEmission = 0.5
                
                -- æœ‰æœºè„‰åŠ¨
                effect.Texture = "rbxassetid://241602659"  -- æœ‰æœºçº¹ç†
            else
                -- éšæœºç”ŸåŒ–æ–¹æ¡ˆ
                local bioSchemes = {
                    BiohazardPalette.InfectionPulse,
                    BiohazardPalette.BioGlow,
                    BiohazardPalette.ToxicSlime
                }
                scheme = bioSchemes[math.random(1, #bioSchemes)]
                viscosity = 1.2
            end
            
            effect.Color = scheme
            
            -- ç²˜ç¨ æ¶²ä½“å¤§å°å˜åŒ–
            effect.Size = NumberSequence.new({
                NumberSequenceKeypoint.new(0, (effect.Size and effect.Size.Keypoints[1].Value or 1) * viscosity * 0.6),
                NumberSequenceKeypoint.new(0.4, (effect.Size and effect.Size.Keypoints[1].Value or 1) * viscosity * 1.3),
                NumberSequenceKeypoint.new(0.7, (effect.Size and effect.Size.Keypoints[1].Value or 1) * viscosity * 0.8),
                NumberSequenceKeypoint.new(1, (effect.Size and effect.Size.Keypoints[1].Value or 1) * viscosity * 0.4)
            })
            
            -- é€æ˜åº¦å˜åŒ–ï¼ˆæ¨¡æ‹Ÿæ°”æ³¡/æ¶²ä½“ï¼‰
            effect.Transparency = NumberSequence.new({
                NumberSequenceKeypoint.new(0, 0.2),
                NumberSequenceKeypoint.new(0.5, 0.1),
                NumberSequenceKeypoint.new(0.8, 0.3),
                NumberSequenceKeypoint.new(1, 0.6)
            })
            
            -- æ·»åŠ æœ‰æœºçº¹ç†
            if math.random(1, 2) == 1 then
                if isSlime then
                    effect.Texture = "rbxassetid://243664672"  -- æ°”æ³¡çº¹ç†
                elseif isOrganic then
                    effect.Texture = "rbxassetid://243664596"  -- ç»†èƒçº¹ç†
                end
            end
            
        elseif effect:IsA("Beam") then
            -- æ¯’æ¶²æŸ/ç”Ÿç‰©æ¿€å…‰
            effect.Color = BiohazardPalette.ToxicSlime
            effect.Width0 = (effect.Width0 or 0.5) * 1.4
            effect.Width1 = (effect.Width1 or 0.5) * 1.4
            effect.Texture = "rbxassetid://446111271"  -- é—ªç”µçº¹ç†æ¨¡æ‹Ÿæ¯’æ¶²æµåŠ¨
            effect.TextureSpeed = 1.2
            effect.LightEmission = 0.7
            effect.TextureLength = 2.5
            
            -- æ¯’æ¶²æ»´è½æ•ˆæœ
            effect.CurveSize0 = 0.3
            effect.CurveSize1 = 0.3
            
        elseif effect:IsA("Trail") then
            -- æ¯’æ¶²è½¨è¿¹
            effect.Color = BiohazardPalette.InfectionPulse
            effect.LightEmission = 0.6
            effect.Transparency = NumberSequence.new({
                NumberSequenceKeypoint.new(0, 0.1),
                NumberSequenceKeypoint.new(0.4, 0.3),
                NumberSequenceKeypoint.new(0.8, 0.5),
                NumberSequenceKeypoint.new(1, 1)
            })
            effect.WidthScale = NumberSequence.new({
                NumberSequenceKeypoint.new(0, 1),
                NumberSequenceKeypoint.new(0.6, 0.3),
                NumberSequenceKeypoint.new(1, 0)
            })
            
        elseif effect:IsA("Smoke") then
            -- æ¯’æ€§çƒŸé›¾
            effect.Color = BiohazardPalette.ToxicGreen
            effect.Opacity = 0.3  -- åŠé€æ˜æ¯’é›¾
            effect.RiseVelocity = (effect.RiseVelocity or 1) * 0.6  -- ç¼“æ…¢ä¸Šå‡
            effect.Size = (effect.Size or 4) * 1.7
            effect.Color = BiohazardPalette.ToxicSlime
            
        elseif effect:IsA("Fire") then
            -- ç”ŸåŒ–ç«ç„°ï¼ˆæ¯’ç«ï¼‰
            effect.Color = BiohazardPalette.VirusSpread
            effect.Size = (effect.Size or 5) * 1.3
            effect.Heat = (effect.Heat or 10) * 0.8  -- ä½æ¸©æ¯’ç«
            effect.SecondaryColor = BiohazardPalette.DecayBrown
            
            -- æ¯’ç«é—ªçƒ
            spawn(function()
                while effect.Parent do
                    effect.Color = BiohazardPalette.CorrosionFlow
                    wait(0.4)
                    effect.Color = BiohazardPalette.VirusSpread
                    wait(0.4)
                end
            end)
            
        elseif effect:IsA("Sparkles") then
            -- ç—…æ¯’é¢—ç²’/å­¢å­
            effect.SparkleColor = BiohazardPalette.RadioactiveGreen
            effect.SparkleSize = (effect.SparkleSize or 1) * 2.2
            effect.TimeScale = 0.8  -- ç¼“æ…¢é—ªçƒ
            
        elseif effect:IsA("Explosion") then
            -- ç—…æ¯’çˆ†ç‚¸/æ¯’æ¶²çˆ†è£‚
            effect.BlastPressure = (effect.BlastPressure or 500) * 0.7  -- ç”ŸåŒ–çˆ†ç‚¸å†²å‡»å°
            effect.BlastRadius = (effect.BlastRadius or 5) * 1.5
            effect.DestroyJointRadiusPercent = 0.1
        end
        
        -- æ·»åŠ ç”ŸåŒ–æ ‡è®°
        effect:SetAttribute("Biohazard", true)
        effect:SetAttribute("Toxicity", isToxic and "High" or isVirus and "Extreme" or "Medium")
        effect:SetAttribute("Contagion", math.random(60, 100) / 100)
        
        -- å¦‚æœæ˜¯æ¯’æ€§ç‰¹æ•ˆï¼Œæ·»åŠ è„‰åŠ¨
        if effect:IsA("ParticleEmitter") and (isToxic or isVirus) then
            spawn(function()
                while effect.Parent and effect:GetAttribute("Biohazard") do
                    wait(math.random(0.5, 2))
                    -- æ¯’æ€§è„‰åŠ¨
                    local originalRate = effect.Rate
                    effect.Rate = effect.Rate * 1.5
                    wait(0.2)
                    effect.Rate = originalRate
                end
            end)
        end
    end)
end

-- ğŸ§¬ åº”ç”¨æ‰€æœ‰ç”ŸåŒ–ç‰¹æ•ˆ
local function applyAllBiohazard()
    print("â˜£ï¸ å¼€å§‹åº”ç”¨ç”ŸåŒ–æ¯’æ¶²ç‰¹æ•ˆ...")
    local effectTypes = {"ParticleEmitter", "Beam", "Trail", "Smoke", "Fire", "Sparkles", "Explosion", "Light"}
    local totalEffects = 0
    local bioEffects = 0
    
    for _, descendant in ipairs(game:GetDescendants()) do
        for _, effectType in ipairs(effectTypes) do
            if descendant:IsA(effectType) then
                totalEffects = totalEffects + 1
                if not descendant:GetAttribute("Biohazard") then
                    applyBiohazardEffect(descendant)
                    bioEffects = bioEffects + 1
                end
            end
        end
    end
    
    print(string.format("ğŸ§ª ç”ŸåŒ–æ¯’æ¶²åº”ç”¨å®Œæˆï¼æ€»è®¡ %d ä¸ªç‰¹æ•ˆï¼Œè½¬åŒ– %d ä¸ªç”ŸåŒ–æ•ˆæœ", totalEffects, bioEffects))
    
    -- å…¨å±€ç”ŸåŒ–ç³»ç»Ÿ
    _G.BiohazardSystem = {
        Reapply = applyAllBiohazard,
        SpreadInfection = function(range)
            -- ä¼ æ’­æ„ŸæŸ“
            range = range or 20
            for _, effect in ipairs(game:GetDescendants()) do
                if effect:GetAttribute("Biohazard") then
                    if effect:IsA("ParticleEmitter") then
                        effect.SpreadAngle = Vector2.new(360, 360)
                        effect.VelocitySpread = (effect.VelocitySpread or 10) * 2
                        effect.Speed = NumberRange.new(
                            (effect.Speed and effect.Speed.Min or 2) * 1.5,
                            (effect.Speed and effect.Speed.Max or 5) * 1.5
                        )
                    end
                end
            end
            print("ğŸ¦  æ„ŸæŸ“ä¼ æ’­èŒƒå›´:", range)
        end,
        CorrosionMode = function(enabled)
            -- è…èš€æ¨¡å¼
            for _, effect in ipairs(game:GetDescendants()) do
                if effect:GetAttribute("Biohazard") then
                    if enabled then
                        if effect:IsA("ParticleEmitter") then
                            effect.Color = BiohazardPalette.CorrosionFlow
                            effect.Transparency = NumberSequence.new(0.1, 0.5)
                        elseif effect:IsA("Beam") then
                            effect.Color = ColorSequence.new(BiohazardPalette.CorrosivePurple)
                        end
                    else
                        applyBiohazardEffect(effect)  -- æ¢å¤
                    end
                end
            end
        end,
        Mutate = function()
            -- å˜å¼‚æ•ˆæœï¼ˆé¢œè‰²çªå˜ï¼‰
            for _, effect in ipairs(game:GetDescendants()) do
                if effect:GetAttribute("Biohazard") then
                    if effect:IsA("ParticleEmitter") then
                        -- éšæœºå˜å¼‚é¢œè‰²
                        local mutantColors = {
                            BiohazardPalette.FleshPink,
                            BiohazardPalette.OrganicYellow,
                            BiohazardPalette.MucusCyan,
                            BiohazardPalette.PoisonBlood
                        }
                        effect.Color = ColorSequence.new(mutantColors[math.random(1, #mutantColors)])
                    end
                end
            end
            print("ğŸ§¬ ç”ŸåŒ–å˜å¼‚æ¿€æ´»ï¼")
        end
    }
    
    return bioEffects
end

-- ğŸ§« åˆå§‹æ‰§è¡Œ
applyAllBiohazard()

print("â˜£ï¸ ç”ŸåŒ–æ¯’æ¶²ç³»ç»Ÿå·²æ¿€æ´»")
print("ğŸ¦  è§å…‰æ¯’ç»¿ + ç²˜æ¶²é»„ + è…èš€ç´« + ç—…æ¯’çº¢")
print("âš ï¸ å»ºè®®é…åˆå®éªŒå®¤/æ„ŸæŸ“åŒºåœºæ™¯ä½¿ç”¨")

-- ğŸ”„ ç›‘å¬æ–°ç‰¹æ•ˆ
game.DescendantAdded:Connect(function(newDescendant)
    task.wait(0.1)
    local effectTypes = {"ParticleEmitter", "Beam", "Trail", "Smoke", "Fire", "Sparkles", "Explosion", "Light"}
    for _, effectType in ipairs(effectTypes) do
        if newDescendant:IsA(effectType) then
            task.wait(0.15)
            if not newDescendant:GetAttribute("Biohazard") then
                applyBiohazardEffect(newDescendant)
                print("ğŸ§« æ–°å¢ç”ŸåŒ–æ•ˆæœ:", newDescendant:GetFullName())
            end
        end
    end
end)

-- ğŸ¥ ç”ŸåŒ–ç¯å¢ƒå…‰è®¾ç½®
local function setupBioEnvironment()
    if game:GetService("Lighting") then
        local lighting = game:GetService("Lighting")
        
        -- å®éªŒå®¤/æ„ŸæŸ“åŒºç¯å…‰
        lighting.Ambient = Color3.fromRGB(30, 50, 30)
        lighting.OutdoorAmbient = Color3.fromRGB(40, 60, 40)
        lighting.Brightness = 1.1
        lighting.ColorShift_Bottom = Color3.fromRGB(20, 80, 20)
        lighting.ColorShift_Top = Color3.fromRGB(50, 100, 50)
        
        -- ç»¿è‰²è‰²è°ƒï¼ˆæ¨¡æ‹Ÿå¤œè§†/ç›‘æ§ï¼‰
        if lighting:FindFirstChild("ColorCorrection") then
            lighting.ColorCorrection.TintColor = Color3.fromRGB(180, 255, 180)
            lighting.ColorCorrection.Contrast = 0.15
            lighting.ColorCorrection.Brightness = 0.05
        end
        
        -- æ·»åŠ é›¾æ•ˆï¼ˆæ¯’é›¾ï¼‰
        lighting.FogColor = Color3.fromRGB(20, 40, 20)
        lighting.FogStart = 40
        lighting.FogEnd = 250
        
        -- æ·»åŠ Bloomï¼ˆç”Ÿç‰©å‘å…‰ï¼‰
        if lighting:FindFirstChild("BloomEffect") then
            lighting.BloomEffect.Enabled = true
            lighting.BloomEffect.Intensity = 0.6
            lighting.BloomEffect.Size = 28
            lighting.BloomEffect.Threshold = 0.8
        end
    end
end

-- ğŸ§ª æ¯’æ€§æ§åˆ¶å‡½æ•°
function AdjustToxicity(level)
    level = math.clamp(level or 1, 0.3, 3)
    
    for _, effect in ipairs(game:GetDescendants()) do
        if effect:GetAttribute("Biohazard") then
            local toxicity = effect:GetAttribute("Toxicity")
            
            if effect:IsA("ParticleEmitter") then
                -- è°ƒæ•´é¢œè‰²æ¯’æ€§
                if level > 1.8 then
                    effect.Color = BiohazardPalette.VirusSpread  -- é«˜æ¯’æ€§å˜çº¢ç´«
                elseif level < 0.6 then
                    effect.Color = BiohazardPalette.BioGlow      -- ä½æ¯’æ€§å˜æš—ç»¿
                end
                
                -- è°ƒæ•´ç²’å­å¯†åº¦
                effect.Rate = (effect.Rate or 20) * level
                
            elseif effect:IsA("Fire") then
                effect.Size = (effect.Size or 5) * level
                effect.Heat = (effect.Heat or 10) * level * 0.8
            end
        end
    end
    
    print("ğŸ§ª æ¯’æ€§ç­‰çº§è°ƒæ•´è‡³:", string.format("%.1f", level))
end

-- ğŸ«§ ç”Ÿæˆé»æ¶²æ± æ•ˆæœ
function CreateSlimePool(position, radius)
    radius = radius or 5
    
    local part = Instance.new("Part")
    part.Size = Vector3.new(radius * 2, 0.3, radius * 2)
    part.Position = position
    part.Anchored = true
    part.CanCollide = false
    part.Material = Enum.Material.SmoothPlastic
    part.Transparency = 0.3
    part.Color = BiohazardPalette.ToxicGreen
    part.Parent = workspace
    
    -- é»æ¶²è¡¨é¢ç²’å­
    local particle = Instance.new("ParticleEmitter")
    particle.Color = BiohazardPalette.MucusBubble
    particle.Size = NumberSequence.new(0.3, 1.2)
    particle.Transparency = NumberSequence.new(0.1, 0.7)
    particle.Lifetime = NumberRange.new(1, 2)
    particle.Rate = 30
    particle.Speed = NumberRange.new(0.5, 2)
    particle.SpreadAngle = Vector2.new(180, 180)
    particle.Parent = part
    
    -- æ°”æ³¡æ•ˆæœ
    local bubble = Instance.new("ParticleEmitter")
    bubble.Color = BiohazardPalette.MucusBubble
    bubble.Size = NumberSequence.new(0.2, 0.8)
    bubble.Transparency = NumberSequence.new(0.1, 0.9)
    bubble.Lifetime = NumberRange.new(0.8, 1.5)
    bubble.Rate = 20
    bubble.Speed = NumberRange.new(1, 3)
    bubble.Acceleration = Vector3.new(0, 5, 0)
    bubble.Parent = part
    
    -- è„‰åŠ¨æ•ˆæœ
    spawn(function()
        while part.Parent do
            part.Transparency = 0.2
            particle.Rate = 40
            bubble.Rate = 25
            wait(1.5)
            part.Transparency = 0.4
            particle.Rate = 20
            bubble.Rate = 15
            wait(1)
        end
    end)
    
    print("ğŸ«§ é»æ¶²æ± ç”Ÿæˆäº:", position)
    return part
end

-- ğŸ§« ç”Ÿæˆç—…æ¯’äº‘æ•ˆæœ
function CreateVirusCloud(position)
    local part = Instance.new("Part")
    part.Size = Vector3.new(8, 8, 8)
    part.Position = position
    part.Anchored = true
    part.CanCollide = false
    part.Transparency = 1
    part.Parent = workspace
    
    -- ç—…æ¯’ç²’å­äº‘
    local particle = Instance.new("ParticleEmitter")
    particle.Color = BiohazardPalette.VirusSpread
    particle.Size = NumberSequence.new(0.2, 0.8)
    particle.Transparency = NumberSequence.new(0, 0.8)
    particle.Lifetime = NumberRange.new(3, 5)
    particle.Rate = 100
    particle.Speed = NumberRange.new(0.5, 2)
    particle.SpreadAngle = Vector2.new(360, 360)
    particle.Drag = 1
    particle.Parent = part
    
    -- ç¼“æ…¢ç§»åŠ¨
    spawn(function()
        while part.Parent do
            part.Position = part.Position + Vector3.new(
                math.random(-1, 1) * 0.1,
                0,
                math.random(-1, 1) * 0.1
            )
            wait(0.5)
        end
    end)
    
    print("ğŸ¦  ç—…æ¯’äº‘ç”Ÿæˆäº:", position)
    return part
end

-- å¯¼å‡ºæ¨¡å—
return {
    Apply = applyAllBiohazard,
    Toxicity = AdjustToxicity,
    Spread = _G.BiohazardSystem and _G.BiohazardSystem.SpreadInfection,
    Corrode = _G.BiohazardSystem and _G.BiohazardSystem.CorrosionMode,
    Mutate = _G.BiohazardSystem and _G.BiohazardSystem.Mutate,
    Environment = setupBioEnvironment,
    CreateSlime = CreateSlimePool,
    CreateVirusCloud = CreateVirusCloud,
    Colors = BiohazardPalette
}
