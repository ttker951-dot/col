local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

if not RunService:IsClient() then
    warn("此脚本仅在客户端运行")
end

-- 纯红色调色板
local RedPalette = {
    Bright = Color3.fromRGB(255, 0, 0),         -- 亮红
    Deep = Color3.fromRGB(200, 0, 0),           -- 深红
    Dark = Color3.fromRGB(150, 0, 0),           -- 暗红
    ParticleDefault = ColorSequence.new(Color3.fromRGB(255, 0, 0))
}

local function dyeEffectRed(effect)
    pcall(function()
        if effect:IsA("ParticleEmitter") then
            effect.Color = RedPalette.ParticleDefault
            -- 1/3的概率使用红色渐变
            if math.random(1, 3) == 1 then
                effect.Color = ColorSequence.new({
                    ColorSequenceKeypoint.new(0, RedPalette.Dark),
                    ColorSequenceKeypoint.new(1, RedPalette.Bright)
                })
            end
        elseif effect:IsA("Beam") then
            effect.Color = ColorSequence.new(RedPalette.Bright)
        elseif effect:IsA("Trail") then
            effect.Color = ColorSequence.new(RedPalette.Bright)
        elseif effect:IsA("Smoke") then
            effect.Color = Color3.new(0.8, 0, 0) -- 红色烟雾
            effect.Opacity = 0.8
        elseif effect:IsA("Fire") then
            effect.Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, RedPalette.Dark),
                ColorSequenceKeypoint.new(0.5, RedPalette.Deep),
                ColorSequenceKeypoint.new(1, RedPalette.Bright)
            })
            effect.Size = effect.Size * 1.3
        elseif effect:IsA("Sparkles") then
            effect.SparkleColor = RedPalette.Bright
        elseif effect:IsA("Explosion") then
            effect.BlastPressure = 1
            effect.BlastRadius = 20
        end
        effect:SetAttribute("DyedRed", true)
    end)
end

local function dyeAllEffectsRed()
    print("正在将所有特效染为红色...")
    local effectTypes = {"ParticleEmitter", "Beam", "Trail", "Smoke", "Fire", "Sparkles", "Explosion"}
    local totalEffects = 0
    local dyedEffects = 0
    
    for _, descendant in ipairs(game:GetDescendants()) do
        for _, effectType in ipairs(effectTypes) do
            if descendant:IsA(effectType) then
                totalEffects = totalEffects + 1
                if not descendant:GetAttribute("DyedRed") then
                    dyeEffectRed(descendant)
                    dyedEffects = dyedEffects + 1
                end
            end
        end
    end
    
    print(string.format("已找到 %d 个特效，成功染色 %d 个", totalEffects, dyedEffects))
    _G.RedEffects = {
        Reapply = dyeAllEffectsRed,
        Palette = RedPalette,
        DyeFunction = dyeEffectRed
    }
    return dyedEffects
end

dyeAllEffectsRed()

print("红色特效系统已激活")
print("使用 _G.RedEffects.Reapply() 重新应用红色")
print("使用 _G.RedEffects.DyeFunction(特效实例) 单独染色")

-- 监听新加入的特效
game.DescendantAdded:Connect(function(newDescendant)
    task.wait(0.05)
    local effectTypes = {"ParticleEmitter", "Beam", "Trail", "Smoke", "Fire", "Sparkles", "Explosion"}
    for _, effectType in ipairs(effectTypes) do
        if newDescendant:IsA(effectType) then
            task.wait(0.1)
            if not newDescendant:GetAttribute("DyedRed") then
                dyeEffectRed(newDescendant)
                print("已染色新特效: " .. newDescendant:GetFullName())
            end
        end
    end
end)
