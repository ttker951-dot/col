local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

if not RunService:IsClient() then
    warn("æœªæ¥ç§‘æŠ€ç‰¹æ•ˆä»…å®¢æˆ·ç«¯ç”Ÿæ•ˆ")
end

-- ğŸŒ æœªæ¥ç§‘æŠ€é…è‰²æ–¹æ¡ˆ
local FutureTechPalette = {
    -- æ ¸å¿ƒç§‘æŠ€è‰²
    HologramBlue = Color3.fromRGB(0, 255, 255),      -- å…¨æ¯è“ #00FFFF
    MatrixGreen = Color3.fromRGB(0, 255, 0),         -- çŸ©é˜µç»¿ #00FF00
    DataStreamWhite = Color3.fromRGB(240, 255, 255), -- æ•°æ®æµç™½ #F0FFFF
    
    -- é«˜çº§é‡‘å±
    Nanosilver = Color3.fromRGB(192, 192, 192),      -- çº³ç±³é“¶ #C0C0C0
    CircuitGold = Color3.fromRGB(255, 215, 0),       -- ç”µè·¯é‡‘ #FFD700
    EnergyBlue = Color3.fromRGB(30, 144, 255),       -- èƒ½é‡è“ #1E90FF
    
    -- å…‰å­è‰²
    PhotonCore = Color3.fromRGB(255, 255, 255),      -- å…‰å­æ ¸å¿ƒç™½
    PhotonEdgeBlue = Color3.fromRGB(135, 206, 250),  -- å…‰å­è¾¹ç¼˜å¤©è“
    PhotonHaloPurple = Color3.fromRGB(138, 43, 226), -- å…‰å­å…‰æ™•ç´«
    
    -- ç•Œé¢è‰²
    InterfaceCyan = Color3.fromRGB(0, 191, 255),     -- ç•Œé¢é’ #00BFFF
    GridLine = Color3.fromRGB(50, 205, 50),          -- ç½‘æ ¼çº¿ #32CD32
    WarningOrange = Color3.fromRGB(255, 140, 0),     -- è­¦å‘Šæ©™ #FF8C00
    
    -- æ¸å˜é¢„è®¾
    HologramPulse = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 255, 255)),
        ColorSequenceKeypoint.new(0.3, Color3.fromRGB(240, 255, 255)),
        ColorSequenceKeypoint.new(0.6, Color3.fromRGB(0, 255, 0)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 255, 255))
    }),
    
    MatrixFlow = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 50, 0)),
        ColorSequenceKeypoint.new(0.2, Color3.fromRGB(0, 150, 0)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 0)),
        ColorSequenceKeypoint.new(0.8, Color3.fromRGB(0, 150, 0)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 50, 0))
    }),
    
    NanotechGlow = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(192, 192, 192)),
        ColorSequenceKeypoint.new(0.4, Color3.fromRGB(255, 255, 220)),
        ColorSequenceKeypoint.new(0.6, Color3.fromRGB(255, 215, 0)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(192, 192, 192))
    }),
    
    PhotonBeam = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(135, 206, 250)),
        ColorSequenceKeypoint.new(0.1, Color3.fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(0.9, Color3.fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(135, 206, 250))
    }),
    
    DataRain = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 191, 255)),
        ColorSequenceKeypoint.new(0.33, Color3.fromRGB(0, 255, 0)),
        ColorSequenceKeypoint.new(0.66, Color3.fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 191, 255))
    }),
    
    CircuitSpark = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(30, 144, 255)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(255, 215, 0)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 144, 255))
    })
}

-- ğŸ”¬ ç§‘æŠ€æ•ˆæœå¢å¼ºå‡½æ•°
local function enhanceTechEffect(effect)
    pcall(function()
        -- å­˜å‚¨åŸå§‹å±æ€§ï¼ˆç”¨äºæ¢å¤ï¼‰
        if not effect:GetAttribute("OriginalColor") and effect.Color then
            effect:SetAttribute("OriginalColor", effect.Color)
        end
        
        local effectName = effect.Name:lower()
        local isWeapon = string.find(effectName, "gun") or string.find(effectName, "laser") or string.find(effectName, "weapon")
        local isUI = string.find(effectName, "ui") or string.find(effectName, "hud") or string.find(effectName, "interface")
        local isEnergy = string.find(effectName, "energy") or string.find(effectName, "power") or string.find(effectName, "core")
        
        if effect:IsA("ParticleEmitter") then
            -- é€‰æ‹©ç§‘æŠ€æ–¹æ¡ˆ
            local scheme
            if isWeapon then
                scheme = FutureTechPalette.PhotonBeam
                effect.LightEmission = 1
                effect.LightInfluence = 0
                effect.Acceleration = Vector3.new(0, -5, 0)  -- è½»å¾®ä¸‹å 
            elseif isUI then
                scheme = FutureTechPalette.MatrixFlow
                effect.Lifetime = NumberRange.new(0.3, 0.6)  -- çŸ­æš‚å­˜åœ¨
                effect.Rate = (effect.Rate or 20) * 2        -- é«˜é¢‘ç‡
            elseif isEnergy then
                scheme = FutureTechPalette.CircuitSpark
                effect.LightEmission = 0.9
                effect.Speed = NumberRange.new(5, 15)        -- å¿«é€Ÿç§»åŠ¨
            elseif string.find(effectName, "data") or string.find(effectName, "code") then
                scheme = FutureTechPalette.DataRain
                -- æ·»åŠ æ•°å­—çº¹ç†ï¼ˆå¦‚æœæœ‰ï¼‰
                if effect.Texture == "" then
                    effect.Texture = "rbxassetid://241602659"  -- æ•°å­—çº¹ç†
                end
            else
                -- éšæœºç§‘æŠ€æ–¹æ¡ˆ
                local techSchemes = {
                    FutureTechPalette.HologramPulse,
                    FutureTechPalette.NanotechGlow,
                    FutureTechPalette.CircuitSpark
                }
                scheme = techSchemes[math.random(1, #techSchemes)]
            end
            
            effect.Color = scheme
            
            -- å¢å¼ºç§‘æŠ€æ„Ÿ
            effect.LightEmission = math.max(effect.LightEmission or 0.3, 0.7)
            effect.Transparency = NumberSequence.new({
                NumberSequenceKeypoint.new(0, 0.1),
                NumberSequenceKeypoint.new(0.5, 0.05),
                NumberSequenceKeypoint.new(1, 0.9)
            })
            
            -- ç½‘æ ¼çŠ¶å¤§å°å˜åŒ–
            effect.Size = NumberSequence.new({
                NumberSequenceKeypoint.new(0, (effect.Size and effect.Size.Keypoints[1].Value or 1) * 0.8),
                NumberSequenceKeypoint.new(0.25, (effect.Size and effect.Size.Keypoints[1].Value or 1) * 1.2),
                NumberSequenceKeypoint.new(0.5, (effect.Size and effect.Size.Keypoints[1].Value or 1) * 0.8),
                NumberSequenceKeypoint.new(0.75, (effect.Size and effect.Size.Keypoints[1].Value or 1) * 1.2),
                NumberSequenceKeypoint.new(1, (effect.Size and effect.Size.Keypoints[1].Value or 1) * 0.8)
            })
            
            -- æ·»åŠ ç§‘æŠ€æ„Ÿæ—‹è½¬
            effect.Rotation = NumberRange.new(-180, 180)
            effect.RotSpeed = NumberRange.new(-100, 100)
            
        elseif effect:IsA("Beam") then
            -- æ¿€å…‰/èƒ½é‡æŸ
            effect.Color = FutureTechPalette.PhotonBeam
            effect.Width0 = (effect.Width0 or 0.5) * 1.3
            effect.Width1 = (effect.Width1 or 0.5) * 1.3
            effect.Texture = "rbxassetid://446111271"  -- é—ªç”µçº¹ç†
            effect.TextureSpeed = 3
            effect.LightEmission = 1
            effect.TextureLength = 2
            
            -- æ·»åŠ æ‰«ææ•ˆæœ
            effect.CurveSize0 = 0
            effect.CurveSize1 = 0
            
        elseif effect:IsA("Trail") then
            effect.Color = FutureTechPalette.HologramPulse
            effect.LightEmission = 0.8
            effect.Transparency = NumberSequence.new({
                NumberSequenceKeypoint.new(0, 0),
                NumberSequenceKeypoint.new(0.7, 0.1),
                NumberSequenceKeypoint.new(1, 1)
            })
            
        elseif effect:IsA("Smoke") then
            -- ç§‘æŠ€çƒŸé›¾ï¼ˆåŠé€æ˜æ•°æ®æµï¼‰
            effect.Color = Color3.fromRGB(100, 200, 255)
            effect.Opacity = 0.15  -- æ›´é€æ˜
            effect.RiseVelocity = (effect.RiseVelocity or 1) * 0.5
            effect.Size = (effect.Size or 4) * 1.5
            
        elseif effect:IsA("Fire") then
            -- èƒ½é‡ç«ç„°
            effect.Color = FutureTechPalette.CircuitSpark
            effect.Size = (effect.Size or 5) * 1.2
            effect.Heat = (effect.Heat or 10) * 0.7
            effect.SecondaryColor = FutureTechPalette.HologramBlue
            
        elseif effect:IsA("Sparkles") then
            -- æ•°æ®æµé—ªçƒ
            effect.SparkleColor = FutureTechPalette.InterfaceCyan
            effect.SparkleSize = (effect.SparkleSize or 1) * 2
            effect.TimeScale = 2  -- å¿«é€Ÿé—ªçƒ
            
        elseif effect:IsA("Explosion") then
            effect.BlastPressure = (effect.BlastPressure or 500) * 0.9
            effect.DestroyJointRadiusPercent = 0
            -- çˆ†ç‚¸æ•ˆæœé€šè¿‡ç²’å­å®ç°
        end
        
        -- æ·»åŠ ç§‘æŠ€æ ‡è®°
        effect:SetAttribute("FutureTech", true)
        effect:SetAttribute("TechTier", isWeapon and "Weapon" or isEnergy and "Energy" or "General")
        effect:SetAttribute("ScanLineSpeed", math.random(50, 150))
        
        -- å¦‚æœæ˜¯å…‰æŸï¼Œæ·»åŠ è„‰å†²åŠ¨ç”»
        if effect:IsA("Beam") then
            spawn(function()
                while effect.Parent do
                    local tween = TweenService:Create(effect, TweenInfo.new(0.3), {
                        Width0 = (effect.Width0 or 0.5) * 1.5,
                        Width1 = (effect.Width1 or 0.5) * 1.5
                    })
                    tween:Play()
                    tween.Completed:Wait()
                    
                    local tween2 = TweenService:Create(effect, TweenInfo.new(0.3), {
                        Width0 = effect.Width0 / 1.5,
                        Width1 = effect.Width1 / 1.5
                    })
                    tween2:Play()
                    wait(0.5)
                end
            end)
        end
    end)
end

-- ğŸš€ åº”ç”¨æ‰€æœ‰ç§‘æŠ€ç‰¹æ•ˆ
local function applyAllFutureTech()
    print("ğŸŒ å¼€å§‹åº”ç”¨æœªæ¥ç§‘æŠ€ç‰¹æ•ˆ...")
    local effectTypes = {"ParticleEmitter", "Beam", "Trail", "Smoke", "Fire", "Sparkles", "Explosion", "Light"}
    local totalEffects = 0
    local techEffects = 0
    
    for _, descendant in ipairs(game:GetDescendants()) do
        for _, effectType in ipairs(effectTypes) do
            if descendant:IsA(effectType) then
                totalEffects = totalEffects + 1
                if not descendant:GetAttribute("FutureTech") then
                    enhanceTechEffect(descendant)
                    techEffects = techEffects + 1
                end
            end
        end
    end
    
    print(string.format("ğŸ›¸ æœªæ¥ç§‘æŠ€åº”ç”¨å®Œæˆï¼æ€»è®¡ %d ä¸ªç‰¹æ•ˆï¼Œè½¬åŒ– %d ä¸ªç§‘æŠ€æ•ˆæœ", totalEffects, techEffects))
    
    -- å…¨å±€ç§‘æŠ€ç³»ç»Ÿ
    _G.FutureTechSystem = {
        Reapply = applyAllFutureTech,
        ScanMode = function(enabled)
            -- å¼€å¯æ‰«æçº¿æ•ˆæœ
            for _, effect in ipairs(game:GetDescendants()) do
                if effect:GetAttribute("FutureTech") and effect:IsA("ParticleEmitter") then
                    if enabled then
                        effect.Transparency = NumberSequence.new({
                            NumberSequenceKeypoint.new(0, 0.3),
                            NumberSequenceKeypoint.new(0.5, 0),
                            NumberSequenceKeypoint.new(1, 0.3)
                        })
                        effect.Acceleration = Vector3.new(0, 10, 0)  -- å‘ä¸Šæ‰«æ
                    else
                        effect.Transparency = NumberSequence.new({
                            NumberSequenceKeypoint.new(0, 0.1),
                            NumberSequenceKeypoint.new(0.5, 0.05),
                            NumberSequenceKeypoint.new(1, 0.9)
                        })
                        effect.Acceleration = Vector3.new(0, 0, 0)
                    end
                end
            end
        end,
        DataStream = function(speed)
            -- æ§åˆ¶æ•°æ®æµé€Ÿåº¦
            for _, effect in ipairs(game:GetDescendants()) do
                if effect:GetAttribute("FutureTech") and effect:IsA("ParticleEmitter") then
                    effect.Speed = NumberRange.new(
                        (effect.Speed and effect.Speed.Min or 2) * (speed or 1),
                        (effect.Speed and effect.Speed.Max or 5) * (speed or 1)
                    )
                end
            end
        end,
        Overload = function()
            -- è¿‡è½½æ•ˆæœï¼ˆæ‰€æœ‰ç‰¹æ•ˆå˜çº¢ï¼‰
            for _, effect in ipairs(game:GetDescendants()) do
                if effect:GetAttribute("FutureTech") then
                    if effect:IsA("ParticleEmitter") then
                        effect.Color = ColorSequence.new(Color3.fromRGB(255, 50, 50))
                    elseif effect:IsA("Beam") then
                        effect.Color = ColorSequence.new(Color3.fromRGB(255, 0, 0))
                    end
                end
            end
            wait(1)
            applyAllFutureTech()  -- æ¢å¤æ­£å¸¸
        end
    }
    
    return techEffects
end

-- ğŸ“¡ åˆå§‹æ‰§è¡Œ
applyAllFutureTech()

print("ğŸŒ æœªæ¥ç§‘æŠ€ç³»ç»Ÿå·²æ¿€æ´»")
print("ğŸ’¾ å…¨æ¯è“ + çŸ©é˜µç»¿ + çº³ç±³é“¶")
print("âš¡ å»ºè®®é…åˆèµ›åšæœ‹å…‹åœºæ™¯ä½¿ç”¨")

-- ğŸ”„ ç›‘å¬æ–°ç‰¹æ•ˆ
game.DescendantAdded:Connect(function(newDescendant)
    task.wait(0.08)
    local effectTypes = {"ParticleEmitter", "Beam", "Trail", "Smoke", "Fire", "Sparkles", "Explosion", "Light"}
    for _, effectType in ipairs(effectTypes) do
        if newDescendant:IsA(effectType) then
            task.wait(0.12)
            if not newDescendant:GetAttribute("FutureTech") then
                enhanceTechEffect(newDescendant)
                print("ğŸ“Š æ–°å¢ç§‘æŠ€æ•ˆæœ:", newDescendant:GetFullName())
            end
        end
    end
end)

-- ğŸ™ï¸ æœªæ¥ç¯å¢ƒå…‰è®¾ç½®
local function setupFutureEnvironment()
    if game:GetService("Lighting") then
        local lighting = game:GetService("Lighting")
        
        -- èµ›åšæœ‹å…‹é£æ ¼ç¯å…‰
        lighting.Ambient = Color3.fromRGB(20, 30, 50)
        lighting.OutdoorAmbient = Color3.fromRGB(30, 40, 60)
        lighting.Brightness = 1.5
        lighting.ColorShift_Bottom = Color3.fromRGB(0, 100, 200)
        lighting.ColorShift_Top = Color3.fromRGB(100, 0, 200)
        
        -- æ·»åŠ é›¾æ•ˆ
        lighting.FogColor = Color3.fromRGB(10, 20, 40)
        lighting.FogStart = 50
        lighting.FogEnd = 300
        
        -- æ·»åŠ Bloomåå¤„ç†
        if lighting:FindFirstChild("BloomEffect") then
            lighting.BloomEffect.Enabled = true
            lighting.BloomEffect.Intensity = 0.5
            lighting.BloomEffect.Size = 24
            lighting.BloomEffect.Threshold = 0.9
        end
    end
end

-- âš™ï¸ ç§‘æŠ€ç‰¹æ•ˆæ§åˆ¶
function TechPulse(pulseRate)
    pulseRate = pulseRate or 0.5
    for _, effect in ipairs(game:GetDescendants()) do
        if effect:GetAttribute("FutureTech") then
            if effect:IsA("ParticleEmitter") then
                -- åŒæ­¥è„‰å†²æ•ˆæœ
                local tween = TweenService:Create(effect, TweenInfo.new(pulseRate/2), {
                    Rate = (effect.Rate or 20) * 2
                })
                tween:Play()
                tween.Completed:Wait()
                
                local tween2 = TweenService:Create(effect, TweenInfo.new(pulseRate/2), {
                    Rate = effect.Rate / 2
                })
                tween2:Play()
            end
        end
    end
    print("âš™ï¸ ç§‘æŠ€è„‰å†²é¢‘ç‡:", pulseRate)
end

-- å…¨å±€æ‰«æçº¿æ•ˆæœ
function ActivateScanLines()
    for _, part in ipairs(workspace:GetDescendants()) do
        if part:IsA("BasePart") and not part:GetAttribute("HasScanLine") then
            local attachment = Instance.new("Attachment", part)
            local beam = Instance.new("Beam")
            beam.Attachment0 = attachment
            beam.Attachment1 = attachment
            beam.Color = FutureTechPalette.MatrixFlow
            beam.Width0 = 0.1
            beam.Width1 = 0.1
            beam.Parent = part
            beam.LightEmission = 1
            beam.Texture = "rbxassetid://446111271"
            beam.TextureSpeed = 10
            
            part:SetAttribute("HasScanLine", true)
            part:SetAttribute("ScanBeam", beam)
        end
    end
    print("ğŸ“¡ å…¨å±€æ‰«æçº¿å·²æ¿€æ´»")
end

-- å¯¼å‡ºæ¨¡å—
return {
    Apply = applyAllFutureTech,
    Pulse = TechPulse,
    ScanLines = ActivateScanLines,
    Environment = setupFutureEnvironment,
    Overload = _G.FutureTechSystem and _G.FutureTechSystem.Overload,
    Colors = FutureTechPalette
}
